#!/usr/bin/env python3
import asyncio
import aiohttp
import os

# 你的 IP:PORT 列表
ips = [
    "183.188.22.119:6000","183.188.159.5:6000","116.179.149.75:6000","171.119.207.249:6000","118.79.12.76:6000","118.79.119.188:6000","183.188.21.178:6000","171.119.204.148:6000","171.119.204.139:6000","116.179.149.240:6000","183.188.29.16:6000","118.79.115.112:6000","118.79.115.129:6000","171.125.90.145:6000","116.179.149.88:6000","183.188.21.43:6000","118.79.139.102:6000","183.188.229.36:6000","118.79.113.25:6000","124.163.112.239:6000","171.119.205.16:6000","118.79.112.172:6000","183.188.21.217:6000","171.119.207.68:6000","183.188.159.207:6000","171.119.205.21:6000","171.119.206.99:6000","183.188.28.86:6000","118.79.19.251:6000","183.188.28.243:6000","118.79.119.90:6000","118.79.119.46:6000","171.119.206.129:6000","171.119.206.12:6000","171.119.207.105:6000","183.188.229.191:6000","183.188.229.188:6000","183.188.229.193:6000","183.188.29.26:6000","183.188.22.235:6000","116.179.148.92:6000","116.179.149.104:6000","116.179.149.117:6000","171.119.206.74:6000","116.179.149.219:6000","171.119.206.112:6000","183.188.21.135:6000","183.188.159.228:6000","183.188.20.130:6000","183.188.20.182:6000","171.125.90.78:6000","171.125.90.80:6000","183.188.159.107:6000","183.188.159.75:6000","183.188.20.49:6000","118.79.12.171:6000","183.188.227.73:6000","124.163.102.138:6000","118.79.7.39:6000","124.163.102.111:6000","124.163.102.59:6000","118.79.112.198:6000","124.163.112.168:6000","183.188.159.215:6000","118.79.114.58:6000","118.79.113.214:6000","118.79.115.47:6000","118.79.7.111:6000","124.163.112.32:6000","118.79.114.108:6000","124.163.112.226:6000","124.163.112.104:6000","118.79.115.214:6000","124.163.23.62:6000","183.188.195.184:6000","183.188.195.187:6000","118.79.19.18:6000","183.188.22.72:6000","183.188.28.22:6000","183.188.22.234:6000","124.163.102.174:6000","124.163.102.173:6000","183.188.22.243:6000","116.179.130.2:6000","171.119.204.66:6000","118.79.139.194:6000","118.79.7.33:6000","183.188.159.83:6000","118.79.112.54:6000","118.79.7.191:6000","118.79.12.100:6000","183.188.159.86:6000","118.79.12.75:6000","223.10.214.230:6000","223.10.214.222:6000","223.10.214.216:6000","183.188.197.9:6000","118.79.119.238:6000","118.79.7.94:6000","116.179.130.148:6000","183.188.195.221:6000","116.179.148.105:6000","183.188.29.63:6000","171.119.204.225:6000","171.119.205.159:6000","118.79.115.98:6000","171.119.207.134:6000","171.119.204.204:6000","118.79.7.237:6000","183.188.22.67:6000","183.188.20.89:6000","183.188.21.88:6000","171.119.207.28:6000","118.79.113.132:6000","171.119.204.253:6000","183.188.28.57:6000","118.79.113.146:6000","183.188.197.182:6000","171.119.206.38:6000","171.119.205.154:6000","183.188.28.58:6000","183.188.23.137:6000","183.188.29.9:6000","118.79.113.90:6000","118.79.19.115:6000","118.79.19.120:6000"
]

OUTPUT_FILE = "tvlive/zbip.txt"

async def test_ip(session, ip):
    url = f"http://{ip}/status"
    try:
        async with session.get(url, timeout=5) as resp:
            if resp.status == 200:
                print(f"✅ 可用: {ip}")
                return ip
    except:
        pass
    print(f"❌ 不可用: {ip}")
    return None

async def main():
    os.makedirs(os.path.dirname(OUTPUT_FILE) or ".", exist_ok=True)
    connector = aiohttp.TCPConnector(limit=50)  # 并发限制
    async with aiohttp.ClientSession(connector=connector) as session:
        tasks = [test_ip(session, ip) for ip in ips]
        results = await asyncio.gather(*tasks)
    available = [ip for ip in results if ip]
    with open(OUTPUT_FILE, "w") as f:
        for ip in available:
            f.write(ip + "\n")
    print(f"\n✅ 总共可用 IP: {len(available)}")
    for ip in available:
        print(ip)

if __name__ == "__main__":
    asyncio.run(main())
